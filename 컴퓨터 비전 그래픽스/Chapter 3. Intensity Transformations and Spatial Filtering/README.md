# Chapter 3. Intensity Transformations and Spatial Filtering 정리 내용

## 개요
디지털 영상의 명암 조절, 잡음 제거 등 기법을 배우는 장

## 1. 강도 변환(Intensity Transformations)
강도 변환이란 영상의 각 픽셀 밝기 값을 변경하는 기법을 말한다.
<br>
전역적으로 이미지의 밝기/대비를 조절하거나 특정 부분을 강조할 수 있다.

<br>
<br>

### 1.1 영상 반전(Negative Trasformation, 음화 변환)

<pre>
수식

s = L - 1 - r

r : 입력 픽셀 값
s : 출력 픽셀 값
L = 픽셀 값 범위의 최대 값
</pre>

어두운 부분을 밝게, 밝은 부분을 어둡게 바꾸는(반전) 방식을 말함
<br>
일반적으로 밝기 대비가 역전되는 효과를 냄
<br>
<br>
X-ray 영상, 흑백 필름, 구조 대비가 부족한 영상에 사용함

<br>
<br>

### 1.2 로그 변환(Log Transformation)

<pre>
수식
  
  s = c⋅log(1 + r)

  r : 입력 픽셀
  c : 상수
</pre>

어두운 부분을 확대, 밝은 부분을 압축하여 영상의 동적 범위를 확장하는 방법
<br>
값이 작을수록 더 크게 변하고 클수록 변화가 줄어듦(반비례)
<br>
<br>
푸리에 스펙트럼, 저조도 영상, 천체 이미지 등에서 미세한 세부 표현에 사용함

<br>
<br>

### 1.3 감마 변환(Power-Law / Gamma Transformation, 감마 보정)

화면 디스플레이나 프린터에서 출력 시 장치의 감마 왜곡을 보정할 때 사용
<br>
감마가 높은 모니터 등에서 보정을 위해 사용함

<br>

### 1.4 대비 스트레칭(Contrast Stretching, 대비 확장)
영상에서 특정 범위의 밝기 값에만 픽셀이 집중되어 있는 경우, 이 범위를 전체 범위로 늘려서 전체적으로 대비를 증가시키는 기법
<br>
선형 함수 또는 구간별 선형 함수에 사용

<br>
<br>

### 1.5 범위 강조 (Gray-Level Slicing)
특정 밝기 구간만 강조하거나 나머지를 제거하여 특정 구조를 부각시키는 기법
<br>
강조 구간만 최대 값, 나머지를 0으로 또는 강조 구간만 최대값, 나머지는 원래 값 유지 등으로 함

<br>
<br>

### 1.6 비트 단위 분석 (Bit-Plane Slicing)
8비트 이미지에서 각 비트 LSB ~ MSB를 분리하여 이미지의 구조와 디테일 정보가 어디에 분포하는지 확인하는 기법
<br>
- LSB : 노이즈, 고주파 정보
- MSB : 구조, 윤곽 등 주요 정보

<br>
<br>

## 히스토그램 처리 (Histogram Processsing)
히스토그램이란 영상의 픽셀 분포를 분석하고, 이를 조작하여 대비 향상, 영역 강조, 스타일 맞춤 등을 수행하는 기법

<br>
<br>

### 2.1 히스토그램 평활화(Histogram Equalization, 히스토그램 균등화) Fig 3.16 ~ Fig 3.22

영상의 픽셀 값 분포를 가능한 한 고르게 분포시키는 방식으로 대비(Contrast)를 높임
<br>
여기서 대비란 서로 다른 픽셀들 간 밝기의 차이를 의미함
<br>
픽셀들이 비슷한 값에 몰려 있으면 대비가 낮고, 다양한 밝기가 고루 퍼져 있으면 대비가 높다고 함
<br>
<br>
수식 요약
<br>

<img width="226" alt="image" src="https://github.com/user-attachments/assets/12c92c2d-db49-4ba0-9c6d-9b52fa05d0d3" />

<br>

의료 영상, 저조도 영상 등에서 대비 향상에 사용됨


<br>
<br>

### 2.2 히스토그램 사양화(Histogram Specification / Matching, 히스토그램 지정) Fig 3.23 ~ 3.26
특정 목표 히스토그램을 따라가도록 기존 영상을 변형하는 방법
<br>
위의 평활화 방법보다 정밀한 조절 가능
<br>
<br>
과정은 3단계로 나뉨
1. 입력 영상의 CDF 계산
2. 목표 히스토그램의 CDF 계산
3. CDF 매칭으로 매핑 함수 생성
4. 


<br>
<br>

### 2.3 지역 히스토그램 평활화 (Local Histogram Equalization) FIg 3.32 ~ Fig 3.33
전체 영상이 아니라 작은 블록 단위도 평활화를 수행하여, 전체 구조는 유지하면서 미세한 대비를 강화함
<br>
<br>

### 2.4 Exact Histogram Specification Fig 3.28 ~ 3.31

실제로 지정한 히스토그램에 완벽히 맞추도록 픽셀을 재배열하는 고급 기법
<br>
품질 저하 또는 노이즈 발생 가능성 있음

<br>
<br>

## 3. 공간 필터링 (Spatial Filtering)
이미지에 커널(마스크)을 적용하여 노이즈 제거, 경계 강조, 블러닝, 샤프닝 등을 수행하는 방식
<br>
커널을 픽셀 주변 이웃에 적용하여 연산함

<br>
<br>

### 3.1 스무딩 필터(Smooting Filters, Lowpass Filtering)
스무딩 필터는 영상 내에서 급격한 픽셀 값 변화를 줄이기 위해 사용되는 필터를 말함
<br>
즉, 영상에서 고주파 성분(고속 변화, 노이즈, 엣지 등)을 약화시키고 저주파 성분(천천히 변하는 배경, 완만한 밝기)을 강조함
<br>
후속 처리(에지 검출 등)의 정확도를 높이기 위해 사용됨
<br>
<br>
<br>
스무딩 필터의 주 목적은 2가지
1. 노이즈 제거 : 영상에서 존재하는 불규칙한 픽셀 간 밝기 변화(즉, 노이즈)를 줄임
2. 블러 효과 : 경게가 뚜렷하지 않도록 흐리게(Blur), 즉 고주파를 억제함 (영상이 부드러워짐)


<br>
<br>

#### 박스 필터
3x3, 5x5 등 정사각형 커널 내부의 모든 픽셀에 동일한 가중치를 부여하여 중심 픽셀을 주변 픽셀 평균값으로 대체함
<br>
특징
- 계산이 매우 단순하고 빠름
- 경계(에지)를 흐리게 만들기 때문에 디테일한 정보를 손상시킬 수 있음
- 영상이 탁해진 느낌이 들 수 있음

<br>
<br>

단점
- 영상의 구조가 무너지기 쉬움
- 고주파 성분(경계, 텍스터)을 함께 제거함

<br>
<br>

#### 가우시안 필터(Gaussian Filter)
커널 중심에서 가장 높은 가중치를 주고, 주변으로 갈수록 가중치가 점점 작아지는 정규분포(가우시안 곡선) 기반 필터
<br>
실제 물리 세계(광학적 흐림 효과)와 유사함
<br>
<br>
특징
- 박스 필터보다 더 부드럽고 자연스러운 흐림 효과 제공
- 노이즈를 제거하면서도 구조는 더 잘 유지함
- 가장 널리 사용되는 스무딩 필터임

<br>

응용
- 에지 검출 전 전처리
- 의료 영상 노이즈 감소
- 자연 영상의 고주파 억제

<br>
<br>

#### 패딩(Padding, 경계 처리)
커널이 영상의 가장자리에 도달하면, 커널 외부의 픽셀 값이 존재하지 않아 계산할 수 없음
<br>
해결 방법
- Zero-padding : 외부 값을 0으로 채움 -> 검은 테두리 발생 가능
- Replication : 가장자리 값을 복사하여 확장
- Reflection : 경계를 거울처럼 반사하여 확장
- Circular : 반대편에서 값을 가져옴

<br>

효과
- 각기 다른 방식이 영상의 테두리 품질에 영향을 줌
- 고정된 크기의 영상 결과를 유지하기 위해 필수 처리

<br>
<br>

### 3.2. 샤프닝 필터(Sharpening Filter)
샤프닝은 영상에서 밝기 변화가 큰 경계나 디테일을 강조하여 더 선명하고 뚜렷하게 보이도록 만드는 연산임
<br>
고역통과 필터(Highpass Filter) 계열로 분류됨

<br>
<br>

#### 라플라시안 필터(Laplacian Filter)
원리
- 영상의 2차 미분을 사용하여 경계 검출
- 주변과의 밝기 차이가 클수록 중심 픽셀의 값이 커짐

<br>
<br>

특징
- 경계 검출에 매우 민감함
- 노이즈에도 민감하기 때문에 전처리(스무딩) 필터와 함께 사용 권장됨

<br>
<br>

#### 언샤프 마스크(Unsharp Mask)
특징
- 디테일을 강조하면서도 원본 정보를 보존
- 매우 흔히 사용되는 샤프닝 방법

<br>
<br>

### 3.3 에지 검출(Edge Detection)
경계는 영상에서 밝기가 급격하게 변하는 지점임
<br>
경계는 객체 구분, 윤곽 인식, 형태 분석의 핵심 정보로 사용됨

<br>
<br>

#### 로버츠 연산자(Roberts Operator)
원리
- 2x2 커널 사용, 대각선 방향으로 경계 검출
- 가장 간단하고 계산이 빠르나 노이즈에 매우 민감

<br>
<br>

#### 소벨 연산자(Sobel Operator)
원리
- 3x3 커널을 사용해 수직 및 수평 방향의 경계를 검출
- 중앙에 더큰 가중치를 부여하여 노이즈 억제에 더 강함

<br>
<br>

## 4. 퍼지(Fuzzy)
퍼지 이론은 참 or 거짓의 이진 논리가 아닌 사물이나 상태를 명확히 나누지 않고 연속적인 강도로 표현하는 이론임
<br>
즉, 퍼지는 명확히 밝다 or 어둡다 가 아닌, 얼마나 밝은가 를 다룸

<br>
<br>

### 구성 요소
퍼지 기반 영상 처리 시슽쳄은 4단계 절차로 구성됨

### 4.1 퍼지화(Fuzzification)
픽셀의 밝기 값을 퍼지 집합의 멤버심 값(0 ~ 1 사이)으로 변환
<br>
이 과정을 통해 어둡다 / 중간 / 밝다 같은 애매한 개념을 수치화
<br>
<br>
예시
- 픽셀 값 40 -> 'Dark' 집합 멤버십 0.9
- 픽셀 값 128 -> 'Medium' 집합 0.8
- 픽셀 값 220 -> 'Birght' 집합 0.95

<br>
<br>

멤버십 함수(Mebership Function)
- 삼각형, 사다리꼴, 가우시안 등 다양한 형태

<br>
<br>

### 4.2. 퍼지 규칙(Fuzzy Rule Base)
영상 처리에 사용할 퍼지 if-then 규칙을 정의함
<br>
<br>
예시
- IF 입력이 Dark THEN 출력도 Dark
- IF 입력이 Medium THEN 출력은 더 밝게
- IF 입력이 Bright THEN 출력은 약간 감소

<br>
<br>
특징
- 규칙은 사용자가 설계하거나 학습 기반으로 설정 가능
실제 영상 처리에서는 수십 개 이상의 규칙 조합 사용 가능

<br>
<br>

### 4-3. 퍼지 추론(Fuzzy Infrence)
여러 퍼지 규칙이 동시에 적용되어 나온 퍼지 출력 값들을 하나의 퍼지 집합으로 결합하는 과정
<br>
<br>
예시
- 입력이 0.7 밝고 0.3 중간 -> 두 규칙 모두 적용되고 출력이 혼합됨
- 결과는 출력 퍼지 집합 '중간 밝음'에 강한 멤버십을 가짐

<br>
<br>

### 4-4. 디퍼지화(Defuzzification)
최종 퍼지 출력을 실제 픽셀 값(0 ~ 255 등)으로 변환하는 단계
<br>
즉, 퍼지 시스템에서 나온 애매한 출력을 명확한 수치로 바꾸는 과정임
<br>
<br>
